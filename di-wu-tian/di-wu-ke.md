# 隔离机制
1. 用户空间/内核空间 隔离
2. xv6系统调用

## 如何概括内核的作用?
1. 设备驱动库,用于联系硬件和应用程序.
2. 用于在硬件上运行应用程序.
3. 更高效灵活地使用硬件,通常支持多任务.

## 多任务的必要条件
1. 复用硬件.
2. 多个任务间互相隔离.
3. 多个任务间互相通信.

## 多任务的设计方法
1. 核心: 对资源进行抽象,而非使用原始资源,从而实现对硬件的共享.
2. 使用文件系统,而非直接操作原始硬盘.
3. 使用进程的概念来进行资源管理,而非直接使用CPU和物理内存.
4. 网络通信使用socket来进行抽象,而非原始以太网数据包.

正是通过对硬件资源的抽象才实现了资源的共享.如此一来,应用程序不再需要关心硬件资源,从而实现了更好的可移植性.

## 什么是多任务间隔离?
1. 一个进程通常就是一个隔离的单元.
2. 进程中的错误和失败必须被隔离,不能影响其他进程和内核.
3. 进程X必须无法篡改读取进程Y的内存,文件描述符.
4. 进程X必须无法永久占用CPU.
5. 进程必须无法篡改攻击内核.

## 多任务间隔离的硬件机制
内核使用了硬件提供的隔离机制
1. 用户模式/内核模式的标志位
2. 地址空间
3. 时间分片
4. 系统调用接口

## 硬件: 用户模式/内核模式标志位
1. 用于控制指令是否可以操作特权硬件.
2. 在x86上标志位被称为CPL.它使用了%CS寄存器的最低的两个比特位.
3. CPL=0,被称为内核模式,具有特权级.CPL=3,被称为用户模式,非特权级.
4. CPL保护了很多与隔离机制相关的资源
    
    4.1 IO端口访问权限 
    4.2 控制寄存器访问权限: eflags, %CS, %CS4
    4.3 间接影响了内核访问权限
5. 几乎每个CPU都有类似的用户/内核模式标志位机制.

## 如何通过切换CPL标志位来设计系统调用
### 用户空间先切换标志位,再跳转到系统调用?

```
set CPL=0
jmp sys_open
```
不行,用户空间不应该具有切换标志位的能力.

### 通过混合指令,用户空间在跳转到系统调用的同时切换标志位?
不行,



















----