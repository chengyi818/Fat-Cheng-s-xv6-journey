# 内核地址空间

JOS将32位的线性地址空间划为了两个部分.用户空间位于低地址部分,内核空间位于高地址部分.它们之间的分割线由`inc/memlayout.h`中的`ULIM`来定义,在虚拟地址空间顶部刚好为内核保留了256MB的空间.

`inc/memlayout.h`文件很重要,对后续课程的完成有不小的帮助.

---

## 权限和错误隔离
因为内核地址空间和用户地址空间是隔离的,因此我们需要使用page table中的权限控制位来限制用户代码访问内核的地址空间.否则用户代码将会有意或无意地覆盖内核数据,从而造成各种各样的错误.值得注意的一点是,可写权限位`PTE_W`同时影响内核代码和用户代码.

用户代码没有权限访问高于`ULIM`以上的内核,而内核代码可以读写这个部分.对于`[UTOP, ULIM)`之间地址空间,内核代码和用户代码都只有权限读取,但没有权限写入.这个部分的地址空间是用于将内核的特定数据提供给用户空间读取的.最后低于`UTOP`的空间是供用户空间使用的,用户代码将有权限访问这部分内存.

---

## 初始化内核地址空间

现在我们将要设置`UTOP`之上的地址空间,也就是内核地址空间.`inc/memlayout.h`是我们将要使用的内核空间布局.