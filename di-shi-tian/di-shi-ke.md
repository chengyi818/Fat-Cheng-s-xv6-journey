# 进程, 线程和调度

## 大纲
1. 课后作业
2. 线程切换
3. 调度

## 课后作业
### iderw()
1. 代码目录`xv6/ide.c`
2. `idelock`保护了什么?
    整个系统中可能存在很多进程,每个进程都可以发起ide请求,而ide驱动每次只能处理一个请求.因此需要一个`idequeue`用于缓存这些请求.如果没有`idelock`,那么缓存ide请求时就会发生竞争,导致部分ide请求永远得不到处理.同时发起请求的线程将永远处理sleep状态.
3. 在acquire之后增加sti(),在release之前增加cli(),将会发生什么?为什么?
    现象为可能出现`panic acquire`
    原因: 改动将导致在处理ide请求是,允许发生中断,即当前进程可以被调度.如果线程A获取idelock在core 1上,在线程A sleep之前是可能被调度出去的.如果另一个线程B此时调度到core1上运行,且同时发起了ide请求,那么就会尝试获取idelock.此时idelock->cpu恰好zhix